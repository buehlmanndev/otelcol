services:
  otelcol:
    image: otel/opentelemetry-collector-contrib:0.141.0
    command: ["--config=/etc/otelcol/config.yaml"]
    depends_on:
      hec-mock:
        condition: service_started
    volumes:
      - ./collector/docker/otel-collector.yaml:/etc/otelcol/config.yaml:ro
      - ./tests/fixtures:/fixtures:ro
      - ./tests/output:/output:rw
    environment:
      - SPLUNK_HEC_URL=http://hec-mock:1080/services/collector
      - SPLUNK_HEC_TOKEN=changeme
      - HTTP_PROXY=
      - HTTPS_PROXY=
      - NO_PROXY=127.0.0.1,localhost,hec-mock,otelcol
    networks:
      - otelcol_net
  hec-mock:
    image: mockserver/mockserver:5.15.0
    ports:
      - "1080:1080"
    environment:
      - HTTP_PROXY=
      - HTTPS_PROXY=
      - NO_PROXY=127.0.0.1,localhost,hec-mock,otelcol
    networks:
      - otelcol_net

networks:
  otelcol_net:
    name: otelcol_net
    driver: bridge
